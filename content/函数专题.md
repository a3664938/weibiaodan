# 函数专题   
***

##1. 数字转大写   

在日常使用微表单中，很多场景下需要将录入的数字字段的值转换为大写，比如合同中的金额需要转成大写进行打印。   

下面看下几种不同的数字转换大写的函数写法。   

###（1）数字转大写金额   

在数字转大写的时候，通常有两种情况，一种是金额类数字转大写，一种是普通的数字转大写。   

当金额类数字转大写时，需要用到的函数如下：   

* **CONCATENATE：** 将多个文本字符串合并成一个文本字符串；   
* **[Num2]：** 将数字转为中文大写。123显示为壹佰贰拾叁；   
* **IF：** 判断条件，结果为true的返回值, 结果为false的返回值；   
* **INT(number)：** 将数字向下舍入到最接近的整数；   
* **TEXT(num,text_format)：** 将数字转换成特定格式的文本。   

函数编写整体如下（含角分）：   

```
CONCAT("人民币",IF(数字>=0,IF(INT(数字)-数字==0,TEXT(INT(数字),"[Num2]")+"元",IF(INT(数字*10)-数字*10==0,TEXT(INT(数字),"[Num2]")+"元"+TEXT(INT(数字*10)-INT(数字)*10,"[Num2]")+"角",TEXT(INT(数字),"[Num2]")+"元"+TEXT(INT(数字*10)-INT(数字)*10,"[Num2]")+"角"+TEXT(INT(数字*100)-INT(数字*10)*10,"[Num2]")+"分")),IF(INT(数字*-1)-数字*-1==0,"负"+TEXT(INT(数字*-1),"[Num2]")+"元",IF(INT(数字*10*-1)-数字*10*-1==0,"负"+TEXT(INT(数字*-1),"[Num2]")+"元"+TEXT(INT(数字*10*-1)-INT(数字*-1)*10,"[Num2]")+"角","负"+TEXT(INT(数字*-1),"[Num2]")+"元"+TEXT(INT(数字*10*-1)-INT(数字*-1)*10,"[Num2]")+"角"+TEXT(INT(数字*100*-1)-INT(数字*10*-1)*10,"[Num2]")+"分"))))  
```   

函数编写整体如下（不含角分）：
```
CONCAT("人民币",IF(数字>=0,IF(INT(数字)-数字==0,TEXT(INT(数字),"[Num2]")+"元整",IF(INT(数字*10)-数字*10==0,TEXT(INT(数字),"[Num2]")+"元"+TEXT(INT(数字*10)-INT(数字)*10,"[Num2]")+"角整",TEXT(INT(数字),"[Num2]")+"元"+TEXT(INT(数字*10)-INT(数字)*10,"[Num2]")+"角"+TEXT(INT(数字*100)-INT(数字*10)*10,"[Num2]")+"分整")),IF(INT(数字*-1)-数字*-1==0,"负"+TEXT(INT(数字*-1),"[Num2]")+"元整",IF(INT(数字*10*-1)-数字*10*-1==0,"负"+TEXT(INT(数字*-1),"[Num2]")+"元"+TEXT(INT(数字*10*-1)-INT(数字*-1)*10,"[Num2]")+"角整","负"+TEXT(INT(数字*-1),"[Num2]")+"元"+TEXT(INT(数字*10*-1)-INT(数字*-1)*10,"[Num2]")+"角"+TEXT(INT(数字*100*-1)-INT(数字*10*-1)*10,"[Num2]")+"分整"))))
```   
    
>公式中的金额指代的是表单中对应的字段，如复制公式需要将文本「数字」替换成字段值。

###（2）数字转大写（不含小数点）   

数字转大写在不含小数点时需要用到的公式为：

* **TEXT(num,text_format)：** 将数字转换成特定格式的文本。  

函数编写整体如下：   

```
TEXT(数字,"[Num2]")
```   

>公式中的「数字」指代的是表单中对应的字段，如复制本公式需要将文本「数字」替换成字段值。   

###（3）数字转大写（含小数点）   

数字转大写在含小数点时需要用到的公式为：   

* **CONCATENATE：** 将多个文本字符串合并成一个文本字符串；   

* **SPLIT(text, text_separator)：** 将文本按指定字符串分割成数组；   

* **TEXT(num,text_format)：** 将数字转换成特定格式的文本。   

函数编写整体如下：   

```
CONCAT(SPLIT(TEXT(数字,'[Num2]'),'.')[0],"点",SPLIT(TEXT(数字,'[Num2]'),'.')[1])
```   

>公式中的「数字」指代的是表单中对应的字段，如复制公式需要将文本「数字」替换成字段值。   

效果如下：   

![函数专题_数字转大写][函数专题_数字转大写]   

##2. A是否包含B   

在差旅费报销场景中，需要自动判断当前报销单据是否超标，而是否超标需要由多个情况汇总而得。   

需要用到的函数如下：   

* **CONTAIN：** 判断后面的值是否与前面值中的某一个相同。   
* **SPLIT：** 将字符串分割成数组。   

CONTAIN(...args,target,trueVal,falseVal)   


* 当 ...args 是字符串时（默认为字符串）   

  判断 target 是否与 ...args 完全相同，相同返回 trueVal ，否则返回 falseVal 。   


* 当 ...args 是数组时   

  判断 target 是与 ...args 中某一个相同，相同返回 trueVal ，否则返回 falseVal 。   

应用举例1：   

文本类控件   

![逻辑函数_CONTAIN_SPLIT][逻辑函数_CONTAIN_SPLIT]   

![逻辑函数_CONTAIN_SPLIT结果][逻辑函数_CONTAIN_SPLIT结果]   

应用举例2：   

子表单中控件   

![逻辑函数_CONTAIN_子表单控件][逻辑函数_CONTAIN_子表单控件]   

![逻辑函数_CONTAIN_子表单控件_结果1][逻辑函数_CONTAIN_子表单控件_结果1]   

![逻辑函数_CONTAIN_子表单控件_结果2][逻辑函数_CONTAIN_子表单控件_结果2]   
   

##3. 公式生成流水号  

>表单自带流水号控件，为什么还要用公式来生成流水号呢？   
>自带流水号控件在提交表单前，无法获取流水号，是通过后端接口获取的有顺序的数字。   
>而公式生成的流水号是纯前端生成的，在打开表单的一瞬间，就能自动生成并展示。   
>两者区别主要是以下两点：   
>1.自带流水号控件生成的是有顺序的数字。  
>2.公式流水号的优势是可以即时看到生成的流水号。  

公式编辑如下：  

```
CONCAT("CRM",TEXT(TODAY(),"yyyyMMdd"),"-",TEXT(RAND(4)*10000,"0000"))
```   
   
![公式流水号结果][公式流水号结果]   


##4. 子表单分类汇总   

>需求描述：
>用户在子表单里输入了多种类型的费用，可能有重复类型的费用。需要自动汇总不同类型费用，并在主表中指定位置显示。   

表单设计如下：   

![子表单分类汇总][子表单分类汇总]

用到的公式如下：  
```
IF(报销项目=='住宿费',金额,0)
```

[函数专题_数字转大写]:.\assets\公式\函数专题_数字转大写.png
[逻辑函数_CONTAIN_SPLIT]:.\assets\公式\逻辑函数_CONTAIN_SPLIT.png
[逻辑函数_CONTAIN_SPLIT结果]:.\assets\公式\逻辑函数_CONTAIN_SPLIT结果.png
[逻辑函数_CONTAIN_子表单控件]:.\assets\公式\逻辑函数_CONTAIN_子表单控件.png
[逻辑函数_CONTAIN_子表单控件_结果1]:.\assets\公式\逻辑函数_CONTAIN_子表单控件_结果1.png
[逻辑函数_CONTAIN_子表单控件_结果2]:.\assets\公式\逻辑函数_CONTAIN_子表单控件_结果2.png

[公式流水号结果]:.\assets\公式\公式流水号结果.png
[子表单分类汇总]:.\assets\公式\子表单分类汇总.gif


