# 公式规则
***
公式，可以使该字段的值根据公式<font color="blue"> **自动计算出来，不需要再手动填写**</font>。

给例如编辑完单价和数量后，自动计算总价等这样的业务场景提供了支撑。

那么如何写公式呢？本文就会介绍一下公式的规则。

##1.公式在哪里设置   

目前支持编辑公式的字段有3个：「单行文本」、「数字」和「日期时间」。
进入表单设计页面，选中可编辑公式的字段，在字段属性中找到默认值，把默认值的类型改成“公式编辑”，然后在其下方会出现“编辑公式”按钮，点击即可编辑公式。

![公式_公式在哪里设置][公式_公式在哪里设置]




##2.公式的组成   

公式通常由字段、函数、运算符和标点符号组成。

需要注意的是，如果需要在公式中插入字段，应在公式编辑窗口左下角的字段列表中点击该字段，而不是手动输入字段名称。

因为所有的字段，实际上都有一个内置的ID，而所能看见的字段名称，也仅仅是一个名称，所以当公式需要将字段值作为变量的时候，手动输入或复制粘贴都是无效的，因为字段名可以重复。

![公式_公式的组成][公式_公式的组成]
>公式内所有出现的符号，都需要在英文状态下输入。

##3.公式规则   

###（1）在当前/全部表单中点选字段   

公式所要用到的字段，绝大多数情况下是从**当前表单字段**中选择。

只有 MAPX 函数的最后2个参数会用到**全部表单**字段。

<font color="red">提醒：从当前表单字段中点选的字段是蓝色的，从所有表单字段中点选的字段是橙色的。</font>

![公式_字段颜色][公式_字段颜色]

###（2）运算符号   

公式中，除了支持基本的运算操作符+、-、\*、/，还支持比较操作符>、==、<、!=等。


加| 减  | 乘 | 除| 大于| 小于|等于|不等于|大于等于|小于等于
:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--: |:--: | :--:
 +  |  - |  * |  / |  > | <  | =  | !=  |  >= |  <=


<font color="red">提醒：微表单公式中的等于应该用 == ，而不是 = 。</font>


###（3）函数大写   

在使用函数的时候，请用纯大写字母。输入函数时会自动联想，正确的函数会显示为紫色。

![公式_函数大写][公式_函数大写]

###（4）数据类型匹配   

编写公式时，需要注意数据类型的问题：

* 注意函数的参数的数据类型

要按照函数的要求，保证参数的数据类型的正确。

例如，求和函数SUM，该函数要求所有参数都必须是数字类型。

所以对于公式 SUM(字段1,字段2) ，字段1和字段2都需要是数字字段才行，如果字段1是文本字段，就会导致公式无法计算出结果。

* 注意公式的返回值的数据类型

在对字段编辑公式时，不同的字段对公式的返回值的数据类型有不同的要求，不符合要求则可能无法获得正确的结果。

例如，对数字字段编写公式时，数字字段要求返回值的数据类型必须是数字，那么如果公式是 TODAY() , 则公式计算出的结果返回的是一串数字，此时TODAY函数的返回值是时间戳；如果在单行文本字段内使用函数 TODAY() ，则返回的是中国标准时间。

![公式_数据类型][公式_数据类型]

支持编辑公式的表单字段对公式的返回值的数据类型的要求：

字段    |对公式返回值的数据类型的要求
:-:    |:-:
单行文本|文本、数字、日期等
数字   |只能是数字
日期时间|日期或数字（数字会视为单位为毫秒的时间戳）        

***



>扩展阅读（建议进阶用户阅读）：

>上文提到了不同字段对公式返回值的数据类型的要求，会发现单行文本的返回值并不仅限于文本，可以是数字等。

>这是因为在微表单中支持部分数据类型之间的自动转换，数字2可以自动转换为文本2，任何数字都可以这样轻易转换。

>但是文本就不行了，文本"张三"就没法转换成数字，所以数字字段要求其公式的返回值只能是数字。

>编写公式时，我们可以插入字段到公式中，插入到公式中的字段的数据类型和字段对公式返回值的数据类型并非完全相同。

>例如，上文提到了单行文本编写公式时，公式的返回值可以是数字，但是在公式中插入单行文本字段时，该单行文本的数据类型只会是文本。

>常见字段插入公式后的数据类型如下表所示：

字段    |插入公式时的数据类型
:-:    |:-:
单行文本|文本
数字   |只数字
日期时间|ISODATE格式的时间
下拉框  |文本
单选框  |文本
下拉复选|数组
复选框  |数组
成员组件|数组
部门组件|数组
开关    |布尔值



[公式_公式在哪里设置]:..\..\assets\公式\公式_公式在哪里设置.gif
[公式_公式的组成]:..\..\assets\公式\公式_公式的组成.png
[公式_字段颜色]:..\..\assets\公式\公式_字段颜色.png
[公式_函数大写]:..\..\assets\公式\公式_函数大写.png
[公式_数据类型]:..\..\assets\公式\公式_数据类型.png
