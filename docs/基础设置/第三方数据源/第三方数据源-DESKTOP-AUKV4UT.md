# 第三方数据源
***

第三方数据源可以通过接口的方式将本系统之外的数据引入本系统，为本系统服务。此功能拓展了本系统的适用范围同时很好的兼容了企业在用系统的数据。   

第三方数据源使用流程： 

**<font color="blue">新增数据源 --> 发布数据源 --> 使用数据源（关联/导入）</font>**   


##1. 新增数据源

###（1）入口

![第三方数据源_新增数据源入口][第三方数据源_新增数据源入口]   


###（2）新增数据源

![第三方数据源_新增页面][第三方数据源_新增页面]

* 名称   

 您将要新增的第三方系统提供的接口名称，自定义，用于区别不同的第三方数据源。   

* URL地址   

 您将要新增的第三方系统提供的接口地址，第三方系统提供。   

* 请求方式

 Get/Post请求方式，需要选择http请求方式，请求方式不同 **可选参数列表** 中传输类型不同。   
   


* 接口模式   

 接口模式有三类，对应不同的业务场景。   

   * 获取   

   用来获取第三方系统数据的接口。比如，获取现有系统的字典、业务数据等。

   * 推送   

   用来推送表单数据到第三方系统的接口。比如，某个表单新增一条数据后，会同时推送这条数据到指定的第三方系统。   

   * 校验   

   用来在提交表单数据时，验证所提数据是否符合第三方系统所制定的规则。比如，在提交年休假单时，用来校验所填年休假是否小于等于可修年假。   


* 可选参数列表   

   * 参数名   

   参数名需根据所提供的第三方接口的参数名来确定，假设第三方接口需要入参ID，则这里参数名即为ID。  

   * 传输类型   

   这里根据 **请求方式** 会有不同的设置：

      * Get请求：
      可选 Header 或者 URL   

      * Post请求：
      可选 Header 或者 Body   

   * 参数类型   

   有三类，分别如下：   

      * 固定   

      即该第三方数据源的该入参为固定值，新增此数据源时，需要同时设定 参数值 ，在使用这个数据源时，只能传递新增数据源时设定的 参数值 ，而无法自定义这个参数的值。   

      * 动态   

      即该第三方数据源的该入参为动态值，新增此数据源时，无需设定 参数值 ，在使用这个数据源时，需要在表单中指定某个控件来传递这个参数的值。   

      * 第三方系统   

      当 参数类型 选择 第三方系统 时，会弹出 选择第三方系统 的弹窗。这个功能主要是用来获取某些需要权限才能访问的第三方数据源，比如某些接口需要Token才能访问，这里就是用来设置获取Token的配置页面。   

      ![第三方数据源_选择第三方系统][第三方数据源_选择第三方系统]   

   这里的 系统 URL 都是已经配置好的，在这里只需要进行选择。查看 「[第三方系统][第三方系统]」 配置详情。   

   * 参数值   

    只有参数类型选择的是 **固定** 时，这里填的参数值才有意义。   


以上信息填写好之后，点击【下一步】（只有当 **接口模式** 选择 **获取** 时，才需要 【下一步】 ，否则直接 【完成】 数据源新增），进入 字段配置 页面。   

![第三方数据源_修改字段名][第三方数据源_修改字段名]   

在此页面对获取到的数据进行设置。   

这里需要注意的地方有3处：   

* 主键   

 需要选择一个唯一值作为主键。  

* 控件类型   

 >此设置需要选中某个具体字段后，才会显示

 决定使用该数据源时，该字段的数据类型，会影响公式计算等。比如，如果字段设置为日期时间，则此字段不能参加四则运算。   

* 中文描述   

 >此设置需要选中某个具体字段后，才会显示

 这里可以设置该字段的中文名称，便于区分该数据源的不同字段。   

完成以上步骤后，点击【下一步】，进入数据源预览页，确认没有问题后，点击【完成】，完成数据源的新增。   


##2. 发布数据源   

![第三方数据源_发布数据源][第三方数据源_发布数据源]

数据源只有在发布之后，才可以被使用。   

##3. 关联第三方数据源   

**关联第三方数据源：**    

实时获取第三方数据源信息。   

目前可以使用 **关联第三方数据源** 的控件有 **单行文本**，**数字**，**单选框**，**复选框**，**下拉列表**，**下拉复选**，**树形选择**，**关联数据**，**关联查询**，**子表单**。   

根据数据源返回值的不同选择的控件就不同：

###（1）一层一个值   

![第三方数据源_返回值一层一个值][第三方数据源_返回值一层一个值]   

如果数据源返回以上这种结构的数据，则可以选用 **单行文本**，**数字**，**关联数据**，**关联查询**   
以 **单行文本** 为例来详细说明：   

* 添加 **单行文本** 控件, 并进入关联第三方数据源设置页面。   

![单行文本_关联第三方数据源1][单行文本_关联第三方数据源1]    

* 确定第三方数据源所需入参：   

![单行文本_确定第三方数据源入参][单行文本_确定第三方数据源入参]

* 添加所需入参的对应控件：   

![单行文本_关联第三方数据源2][单行文本_关联第三方数据源2]    

* 关联第三方数据源：   

![单行文本_数据源设置][单行文本_数据源设置]   

###（2）一层多个值   

![第三方数据源_返回值一层多个值][第三方数据源_返回值一层多个值]   

如果数据源返回以上这种结构的数据，则可以选用 **单选框**，**复选框**，**下拉列表**，**下拉复选**，**关联数据**，**子表单**。   

设置步骤与 **单行文本** 基本一致，这里就不再赘述。

###（3）多层多个值   

这里的多层多个值需要解释下，我们微表单目前不支持超过两层的返回数据，这里多层的意思是：根据返回的数据，取其中一个值（父节点id）作为入参，再次发起请求，这时候返回了下一层数据（子节点数据），这就是多层多个值的意思。这种数据其实是一种树形结构，所以这种数据我们专门提供了一个控件 **树形选择**。   

**树形选择：**   

* 添加 **树形选择** 控件，并进入关联第三方数据源设置页面。   

![树形选择_第三方数据源设计页][树形选择_第三方数据源设计页]   

* 关联第三方数据源：   

![树形选择_关联第三方数据1][树形选择_关联第三方数据1]   

* 修改父节点参数名   

![树形选择_关联第三方数据2][树形选择_关联第三方数据2]

**<font color="red">注意：如果第三方数据源不需要设置父节点入参，则不需要修改父节点参数名！</font>**   

##4. 从第三方数据源导入

**从第三方数据源导入：**    

设计表单时获取第三方数据源信息，设计好之后，固化第三方数据源信息于微表单，之后该表单中 **从第三方数据源导入** 的控件从微表单获取数据，不再从第三方数据源实时获取数据。

目前可以使用 **从第三方数据源导入** 的控件有 **单选框**，**复选框**，**下拉列表**，**下拉复选**，**树形选择**。前四种配置方法一样，以 **下拉列表** 为例来说明；**树形选择** 单独讲解。   



**下拉列表：**  

* 添加 **下拉列表** 控件，并进入 **第三方导入** 设置页面。   

![从第三方数据源导入_设计页面][从第三方数据源导入_设计页面]   

* 导入第三方数据：   

![从第三方数据源导入_设置页面][从第三方数据源导入_设置页面]   

**树形选择：**    

* 添加 **树形选择** 控件，并进入 第三方导入 设置页面。   

![从第三方数据源导入_树形选择设计页面][从第三方数据源导入_树形选择设计页面]   

* 导入第三方数据：   

![从第三方数据源导入_树形选择设置页面1][从第三方数据源导入_树形选择设置页面1]   

![从第三方数据源导入_树形选择设置页面2][从第三方数据源导入_树形选择设置页面2]   

**<font color="red">注意：如果需要选到下级选项，则必须先展开，再选中，否则保存后无法展开！</font>**


[第三方数据源_新增数据源入口]:../../assets/第三方数据源/第三方数据源_新增数据源入口.png
[第三方数据源_新增页面]:../../assets/第三方数据源/第三方数据源_新增页面.png
[第三方数据源_选择第三方系统]:../../assets/第三方数据源/第三方数据源_选择第三方系统.png
[第三方系统]:../../第三方系统.html
[第三方数据源_修改字段名]:../../assets/第三方数据源/第三方数据源_修改字段名.png
[第三方数据源_发布数据源]:../../assets/第三方数据源/第三方数据源_发布数据源.png
[第三方数据源_返回值一层一个值]:../../assets/第三方数据源/第三方数据源_返回值一层一个值.png
[单行文本_关联第三方数据源1]:../../assets/第三方数据源/单行文本_关联第三方数据源1.png
[单行文本_确定第三方数据源入参]:../../assets/第三方数据源/单行文本_确定第三方数据源入参.png
[单行文本_关联第三方数据源2]:../../assets/第三方数据源/单行文本_关联第三方数据源2.png
[单行文本_数据源设置]:../../assets/第三方数据源/单行文本_数据源设置.png
[第三方数据源_返回值一层多个值]:../../assets/第三方数据源/第三方数据源_返回值一层多个值.png
[树形选择_第三方数据源设计页]:../../assets/第三方数据源/树形选择_第三方数据源设计页.png
[树形选择_关联第三方数据1]:../../assets/第三方数据源/树形选择_关联第三方数据1.png
[树形选择_关联第三方数据2]:../../assets/第三方数据源/树形选择_关联第三方数据2.png
[从第三方数据源导入_设计页面]:../../assets/第三方数据源/从第三方数据源导入_设计页面.png
[从第三方数据源导入_设置页面]:../../assets/第三方数据源/从第三方数据源导入_设置页面.png
[从第三方数据源导入_树形选择设计页面]:../../assets/第三方数据源/从第三方数据源导入_树形选择设计页面.png
[从第三方数据源导入_树形选择设置页面1]:../../assets/第三方数据源/从第三方数据源导入_树形选择设置页面1.png
[从第三方数据源导入_树形选择设置页面2]:../../assets/第三方数据源/从第三方数据源导入_树形选择设置页面2.png
